select* from xgspon;
drop table hd;
with hd as
(;
create table hd as
    select b.thuebao_id, b.ma_Tb, kieuld_id, loaihd_id, e.ten_dv, dv2.ten_dv dv_rp, b.hdtb_id
--        row_number() over (partition by  b.thuebao_id, b.ma_Tb, kieuld_id, loaihd_id order by  b.hdtb_id desc) rn
    from css.v_hd_khachhang@DATAGUARD a
        left join css.V_hd_thuebao@DATAGUARD b on a.hdkh_id = b.hdkh_id
        left join admin.nhanvien@DATAGUARD c on a.ctv_id = c.nhanvien_id
        left join admiN.donvi@DATAGUARD d on c.donvi_id = d.donvi_id
        left join admiN.donvi@DATAGUARD e on d.donvi_cha_id = e.donvi_id
        left join admin.donvi@DATAGUARD dv1 on a.donvi_id = dv1.donvi_id
        left join admin.donvi@DATAGUARD dv2 on dv1.donvi_cha_id = dv2.donvi_id
    where  b.tthd_id <> 7 and b.ma_tb in (select ma_Tb from xgspon);
);
with thd as 
(
    select THUEBAO_ID, MA_TB, KIEULD_ID, LOAIHD_ID, TEN_DV, DV_RP, HDTB_ID, 
    row_number() over (partition by  thuebao_id, ma_Tb, kieuld_id, loaihd_id order by  hdtb_id desc) rn 
    from hd
)
select a.*, nvl(hd.ten_dv, dv_rp) ten_dv
from xgspon a
    join thd hd on a.ma_tb = hd.ma_Tb and a.loaihd_id = hd.loaihd_id and a.kieuld_id = hd.kieuld_id and rn = 1;
    select ngay_Tt from css.v_phieutt_hd@dataguard where ma_Gd ='HCM-TT/02951355'; 'HCM-TT/02970422';
    SELECT* FROM CSS.V_HD_tHUEBAO@DATAGUARD WHERE MA_tB='hoangaivo';
select * from ttkd_Bsc.ct_dongia_Tratruoc where loai_tinh = 'DONGIATRA_OB' and ma_tb in ('myhoa21-10',
'mtuan16-06',
'nmtan-2706',
'quangnghia06-07',
'dnchieu31-12',
'quannghi03-02',
'fiber_kimphung',
'huehoa23-02',
'dtanthuy_13',
'buithithuy_13',
'nguyentuhai',
'phong-fiber',
'minhduong81',
'chanhtam2014',
'b1-7',
'letan971',
'haihue3012',
'vnptonline_1679895',
'a7_22k2',
'kimcuc07',
'diep0806',
'thao31082015',
'bnquy_lmx',
'hnhan17112015',
'phanvanlanh78',
'diemuyen1605',
'dtmt90',
'nq25072016',
'huynguyen072016',
'vantrung100816',
'longvu092016',
'longhung102016',
'tuanduy102016',
'ptnguyen07112016',
'khuon_2016',
'ngockhanhcao',
'leca7017',
'ntknhung170117',
'hoangvu2001',
'nvthuong17',
'ltqtram230217',
'levandinh257',
'bqthai240417',
'htmhang280417',
'httloan74',
'loannt2017',
'nhloan170528',
'vvt062017',
'nguyenvanluan062017',
'minhthuy_0108',
'vankha88',
'quangle17_08',
'nhieu_fiber20.06',
'vanhao092017',
'ntmylan1990',
'ddao29012018',
'dtran28012018',
'hcmdtran28012018',
'lethuy2018',
'tmnhhong2',
'htnghi270318',
'chauthithuy2018',
'nguyenvkhai',
'de2606',
'ntbd18',
'utte19',
'hdt180716',
'dvtien290818',
'hanh103',
'huy101018',
'nng10',
'hcmnng10',
'quoc-gd3',
'danh020219',
'nquang25_2',
'tquan889',
'hcmtquan889',
'hcmvanan_2019',
'xuanhoang007',
'hcmsang230319',
'thuyvan250319',
'phamnam99',
'thogds_2019',
'ngocgiau2019',
'hcmww_phoangon',
'khanh124a',
'lqvinh92',
'linh310519',
'nhphuc541',
'akhai2019',
'son1143',
'knga2019',
'nguyenlan_2019',
'nmducg169',
'hcmsang230319t2',
'hqt1308',
'tonkinco',
'mytrang37',
'nhmp_2019',
'hcmnhmp_2019',
'ctygreenled09',
'vannhi46',
'hcm_vannhi',
'tnt191217',
'hcm_tnt191217',
'ntphong010220',
'nhat-2020',
'hcmyen22',
'yen_hv2t',
'vanch2602',
'ttkien0103',
'dthung177',
'thanhtien85a',
'tho18032020',
'hcmtho1803',
'canh270320',
'hcmcanh270320',
'rob6',
'vulam965',
'ngminh1104',
'duyphuong1982',
'hcmchanhtam2014',
'hcmquocgd3_1',
'hcmnhphuc541',
'ntxt2020',
'hcmnhloan170528',
'minhthohq4',
'hcm_minhtho.1',
'hcmmyphuong7820',
'myphuong7820',
'tand2206',
'athu212',
'ptrung1020',
'xuanhien2',
'hcmlevandinh257',
'tamc1712',
'hcmhien11102016',
'duy_lt',
'hcmha20122017',
'dtvientk',
'hcmkimphung_2020',
'hcmleca7017tk',
'tuyetminh121220',
'hcm_tuyetminh',
'tbp151220',
'hcmtbp151220',
'minhdat-tk',
'hcmthtram22122',
'thtram221220',
'nguyentandung1115',
'hcm_ngtandung1115',
'hcmthedo26122',
'thedo261220',
'nghai-ap6',
'lcv_hd',
'hcmngan182tk',
'ngan182tk',
'hcmdnchieu31-12',
'xiaoc2215',
'hcmkimhoac10',
'hcmdtmt90',
'hcmxuanhoang007',
'hcmhuy101018tk',
'gdbt210225',
'thanhdien474871',
'hcmkhdd_ttdinh',
'khdd_ttdinh',
'khdd_dthuyan',
'minhnhat052021',
'anhquan1621',
'hcmtand2206',
'tothuyngoc',
'hcmtothuyngoc',
'hcm_lvg210604',
'lvg210604',
'ntmnga-2021',
'tduong1512',
'hcmkhuon_2016',
'ntt210608',
'hchieu-2021',
'hcmhchieu-2021',
'lenghi140621',
'hcmson1143',
'vulinh9999',
'hcm_vulinh9999',
'duchuy1806',
'hcmhang2006',
'lamhip4480',
'ntn20621',
'hnhung28',
'minhthu9721',
'hcmrob6',
'mesh0005442',
'thuylinh21921',
'hcmthuylinh21921',
'hcm_thuylinh21921',
'ngan.db',
'hcm_ngan.db1',
'hcm_ngan.db',
'hcmtamc1712',
'songbng6312521',
'hcmpthuong1401',
'dung140122',
'hcmdung140122',
'hcmletan971',
'khdd_ntthoai1',
'hcmkhdd_ntthoai1',
'eh.aq',
'hcm_chnhtrc_3',
'trieu310122',
'kimngoc120222',
'ngd28',
'thuchung67',
'thihong6784215',
'nbpmai220222',
'vanphuong2402',
'trilam250222',
'hcmmtuan16-06',
'dthngocb12',
'nln84',
'hcmnln84',
'pvk80',
'mesh0045397',
'thnaha1606',
'vanchuc7096963',
'hcm_vanchuc_4',
'thuylinh7210308',
'hcm_thuylinh2022',
'minhhoa2805',
'ltt100622',
'mesh0077285',
'hcmchithien0908',
'cxatuyen0922',
'hcmcxatuyen0922',
'quchuy93692671',
'mesh0102456',
'thuyhanglmx',
'thanhdung93705942',
'philong93706670',
'hcm_philong_10',
'batu0510',
'vinhlp93707362',
'minht93708220',
'hcm_minht_12',
'phmquc93710331',
'thuduong93709905',
'hcmnxd111022',
'mesh0106311',
'mesh0106312',
'mesh0106310',
'vanthuan1038-2',
'vanthuan1038-1',
'mesh0106304',
'mesh0106300',
'mesh0106302',
'lama239e',
'vannghia93713983',
'hcm_vannghia_14',
'mesh0105596',
'hcm_dvtien290818',
'tunkit93717425',
'kimha24102022',
'mesh0109151',
'mesh0109161',
'thuthao93718437',
'mesh0108303',
'mesh0108301',
'mesh0108302',
'fiber201022',
'thanhti93',
'ngcgiu93721758',
'hcm_ngcgiu_11',
'nghia01515',
'mesh_nghia01515',
'hcmhoang4cdung',
'hcmnmtan-2706',
'hongphuc.h3',
'hieu20032022',
'mesh0144834',
'lptung040423',
'hcmlptung040423',
'mesh0148836',
'mesh0148835',
'mesh0148837',
'tnlc93817103',
'bc71le0523',
'vtm230503',
'vantng93838540',
'huyntrang9820',
'diem29052023',
'mesh0162372',
'hphat199',
'hcman050623',
'hcm_ntmnga-2021',
'nha080823',
'hcm_tunkhanh_11',
'hcmdtanthuy_13',
'hien010224',
'mesh0213284',
'hcmvanluan0224',
'mesh0230420',
'mesh0230419',
'thuyquynh280524',
'hcm_lquangthai_90',
'lquangthai51p5a');